import React, { useState, useEffect } from 'react';
import { Heart, MessageCircle, Share2, Plus, Search, Home, Users, TrendingUp } from 'lucide-react';

const LetsDoItApp = () => {
  // Add CSS animations for floating text effects
  React.useEffect(() => {
    const style = document.createElement('style');
    style.textContent = `
      @keyframes float-in {
        from {
          opacity: 0;
          transform: translateY(20px) scale(0.8);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      @keyframes bounce-gentle {
        0%, 20%, 50%, 80%, 100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-3px);
        }
        60% {
          transform: translateY(-2px);
        }
      }
      .animate-float-in {
        animation: float-in 0.8s ease-out forwards;
      }
      .animate-bounce-gentle {
        animation: bounce-gentle 2s ease-in-out infinite;
      }
    `;
    document.head.appendChild(style);
    return () => document.head.removeChild(style);
  }, []);
  const [posts, setPosts] = useState([
    {
      id: 1,
      user: {
        name: "Siti's Kuih Corner",
        avatar: "👩‍🍳",
        location: "Taman Desa, KL",
        businessType: "Traditional Food"
      },
      content: "Fresh kuih lapis made with love! 🌈 Each layer tells a story of our heritage. Starting small in my neighborhood, dreaming big for Malaysia! 🇲🇾",
      image: "🧁",
      likes: 24,
      comments: [],
      timestamp: "2 hours ago",
      hashtags: ["#TraditionalFood", "#MalaysianHeritage", "#LetsDoIt"],
      showAIOverlay: false,
      aiComment: "",
      hasShownAI: false
    },
    {
      id: 2,
      user: {
        name: "Ahmad's Tech Repair",
        avatar: "👨‍🔧",
        location: "Subang Jaya",
        businessType: "Tech Services"
      },
      content: "Upgraded my workshop today! Ready to serve my community better. From fixing phones to building dreams! 📱➡️🏢",
      image: "⚡",
      likes: 18,
      comments: [],
      timestamp: "4 hours ago",
      hashtags: ["#TechRepair", "#CommunityFirst", "#Innovation"],
      showAIOverlay: false,
      aiComment: "",
      hasShownAI: false
    },
    {
      id: 3,
      user: {
        name: "Fatima's Batik Studio",
        avatar: "👩‍🎨",
        location: "Melaka",
        businessType: "Arts & Crafts"
      },
      content: "Combining traditional batik with modern designs. Ready to showcase Malaysian artistry to the world! 🎨✨",
      image: "🎨",
      likes: 31,
      comments: [],
      timestamp: "6 hours ago",
      hashtags: ["#Batik", "#MalaysianArt", "#GlobalReady"],
      showAIOverlay: false,
      aiComment: "",
      hasShownAI: false
    }
  ]);

  const [currentTab, setCurrentTab] = useState('home');
  const [showNewPost, setShowNewPost] = useState(false);

  // Enhanced AI Comment Generator with variety and Malaysian context
  const generateAIComment = (post) => {
    const encouragingComments = [
      `🌟 Amazing work ${post.user.name.split("'s")[0]}! Your dedication to quality really shows. Keep building that strong foundation - success follows consistency!`,
      `💪 This is exactly what Malaysian businesses need - passion with purpose! Your community is lucky to have you. From small steps to big leaps! 🚀`,
      `👏 Love seeing local businesses evolve and grow! Your story inspires others to take action. Let's build Malaysia's business ecosystem together! 🇲🇾`,
      `🎯 Perfect example of 'near to far, low to high' growth! You're not just building a business, you're building community trust. Keep going! 💫`,
      `🌱 Every great international company started exactly like this. Your attention to detail and community focus will take you places! Believe in your journey! ✨`
    ];

    const casualFunComments = [
      `Wah! Your skills so power lah! 💪 Other businesses better watch out - competition getting stronger! Keep it up! 😎`,
      `Eh, this quality very the good sia! 👌 I think big companies will want to learn from you soon... 😉`,
      `Alamak! So creative one! 🎨 Your customers sure very happy to find such talent in their neighborhood! 🏠`,
      `Steady lah bro/sis! 🔥 From kampung to international - I can see it happening! Malaysia Boleh! 🇲🇾`,
      `Your passion really show through leh! ✨ Keep this energy, soon you'll be teaching others how to succeed! 📈`
    ];

    const businessFocusedComments = [
      `Smart positioning! 🎯 You're building exactly what Malaysia needs for the future economy. Strategic thinking! 💡`,
      `This foundation work will pay off big time! 📊 When international opportunities come, you'll be ready! 🌍`,
      `Love the community-first approach! 🤝 Strong local roots = strong global branches. You understand the game! 🎮`,
      `Your timing is perfect! ⏰ Building these skills now puts you ahead when the railway opens new opportunities! 🚄`,
      `Quality + Community + Consistency = Success formula! ✅ You're ticking all the boxes for sustainable growth! 📈`
    ];

    const youngEntrepreneurComments = [
      `Wow! Can't believe you're so talented at this young age! 🤩 The editors out there better step up their game to earn their nasi lemak! 😄🍛`,
      `Your generation is going to change everything! 🚀 Mix of traditional values + modern skills = unstoppable combo! 💥`,
      `Young blood with old soul business sense! 👶➡️👴 Respect! You're going to inspire so many peers! 🙌`,
      `This creativity at your age? Alamak! 🎨 By 30, you'll probably own half of Klang Valley! 😂💼`,
      `Generation Z entrepreneur vibes! 📱✨ Traditional businesses + digital thinking = future billionaire material! 💰`
    ];

    // Randomly pick from different comment styles for variety
    const allComments = [
      ...encouragingComments,
      ...casualFunComments, 
      ...businessFocusedComments,
      ...youngEntrepreneurComments
    ];
    
    return allComments[Math.floor(Math.random() * allComments.length)];
  };

  const handleLike = (postId) => {
    setPosts(posts.map(post => 
      post.id === postId 
        ? { ...post, likes: post.likes + 1 }
        : post
    ));
  };

  // Auto-trigger AI comments when posts come into view
  useEffect(() => {
    const timer = setTimeout(() => {
      // Randomly trigger AI overlay on posts that haven't shown it yet
      setPosts(prevPosts => {
        const updatedPosts = [...prevPosts];
        const postToUpdate = updatedPosts.find(p => !p.showAIOverlay && !p.hasShownAI);
        
        if (postToUpdate) {
          const aiComment = generateAIComment(postToUpdate);
          postToUpdate.aiComment = aiComment;
          postToUpdate.showAIOverlay = true;
          postToUpdate.hasShownAI = true;
          
          // Hide overlay after 5 seconds
          setTimeout(() => {
            setPosts(currentPosts => 
              currentPosts.map(p => 
                p.id === postToUpdate.id 
                  ? { ...p, showAIOverlay: false }
                  : p
              )
            );
          }, 5000);
        }
        
        return updatedPosts;
      });
    }, 2000); // Start showing AI comments after 2 seconds

    return () => clearTimeout(timer);
  }, []);

  const handleComment = (postId) => {
    const post = posts.find(p => p.id === postId);
    const aiComment = generateAIComment(post);
    
    // Add to comments section
    setPosts(posts.map(p => 
      p.id === postId 
        ? { 
            ...p, 
            comments: [
              ...p.comments, 
              {
                id: Date.now(),
                user: "🤖 Let's Do It! AI Coach",
                content: aiComment,
                timestamp: "just now"
              }
            ]
          }
        : p
    ));
  };

  const PostCard = ({ post }) => (
    <div className="bg-white rounded-xl shadow-lg mb-6 overflow-hidden border border-gray-100">
      {/* Header */}
      <div className="p-4 flex items-center justify-between">
        <div className="flex items-center space-x-3">
          <div className="text-2xl">{post.user.avatar}</div>
          <div>
            <h3 className="font-bold text-gray-900">{post.user.name}</h3>
            <p className="text-sm text-gray-600">{post.user.location} • {post.businessType}</p>
          </div>
        </div>
        <span className="text-xs text-gray-500">{post.timestamp}</span>
      </div>

      {/* Content */}
      <div className="px-4 pb-3">
        <p className="text-gray-800 mb-3">{post.content}</p>
        <div className="flex flex-wrap gap-1">
          {post.hashtags.map((tag, index) => (
            <span key={index} className="text-blue-600 text-sm hover:text-blue-800 cursor-pointer">
              {tag}
            </span>
          ))}
        </div>
      </div>

      {/* Image/Media with AI Overlay */}
      <div className="relative bg-gradient-to-br from-red-500 via-yellow-500 to-green-500 h-64 flex items-center justify-center overflow-hidden">
        <div className="text-6xl">{post.image}</div>
        
        {/* AI Coach Floating Text Overlay - No Box, Direct on Image */}
        {post.showAIOverlay && (
          <div className="absolute inset-0 flex items-center justify-center p-4 animate-float-in">
            <p 
              className="text-center leading-relaxed animate-bounce-gentle"
              style={{
                fontFamily: 'system-ui, -apple-system, sans-serif',
                fontSize: '16px',
                fontWeight: '600',
                letterSpacing: '0.03em',
                lineHeight: '1.5',
                color: '#ffffff',
                textShadow: `
                  2px 2px 4px rgba(0, 0, 0, 0.8),
                  -1px -1px 2px rgba(0, 0, 0, 0.6),
                  1px 1px 3px rgba(0, 0, 0, 0.9),
                  0 0 10px rgba(0, 0, 0, 0.5)
                `,
                maxWidth: '90%',
                padding: '0 8px'
              }}
            >
              🤖 {post.aiComment}
            </p>
          </div>
        )}
      </div>

      {/* Actions */}
      <div className="p-4">
        <div className="flex items-center justify-between mb-3">
          <div className="flex space-x-6">
            <button 
              onClick={() => handleLike(post.id)}
              className="flex items-center space-x-2 text-gray-600 hover:text-red-500 transition-colors"
            >
              <Heart className="w-5 h-5" />
              <span>{post.likes}</span>
            </button>
            <button 
              onClick={() => handleComment(post.id)}
              className="flex items-center space-x-2 text-gray-600 hover:text-blue-500 transition-colors"
            >
              <MessageCircle className="w-5 h-5" />
              <span>AI Coach</span>
            </button>
            <button className="flex items-center space-x-2 text-gray-600 hover:text-green-500 transition-colors">
              <Share2 className="w-5 h-5" />
              <span>Share</span>
            </button>
          </div>
        </div>

        {/* Comments */}
        {post.comments.length > 0 && (
          <div className="border-t pt-3 mt-3">
            {post.comments.map(comment => (
              <div key={comment.id} className="mb-2 p-3 bg-blue-50 rounded-lg">
                <div className="flex items-center justify-between mb-1">
                  <span className="font-semibold text-sm text-blue-700">{comment.user}</span>
                  <span className="text-xs text-gray-500">{comment.timestamp}</span>
                </div>
                <p className="text-sm text-gray-700">{comment.content}</p>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );

  return (
    <div className="max-w-md mx-auto bg-gray-50 min-h-screen">
      {/* Header */}
      <div className="bg-gradient-to-r from-red-600 via-yellow-500 to-green-600 text-white p-4 sticky top-0 z-10">
        <div className="flex items-center justify-between">
          <h1 className="text-xl font-bold">Let's Do It! 🚀</h1>
          <div className="flex items-center space-x-3">
            <Search className="w-5 h-5" />
            <button 
              onClick={() => setShowNewPost(!showNewPost)}
              className="bg-white bg-opacity-20 p-2 rounded-full"
            >
              <Plus className="w-5 h-5" />
            </button>
          </div>
        </div>
        <p className="text-sm mt-1 opacity-90">Building Malaysian businesses from near to far 🇲🇾</p>
      </div>

      {/* New Post Form */}
      {showNewPost && (
        <div className="bg-white p-4 border-b shadow-sm">
          <textarea 
            className="w-full p-3 border rounded-lg resize-none"
            placeholder="Share your business journey... What are you working on today? 💪"
            rows="3"
          />
          <div className="flex justify-between items-center mt-3">
            <span className="text-sm text-gray-600">🤖 AI will help engage with your post!</span>
            <button className="bg-gradient-to-r from-red-500 to-yellow-500 text-white px-4 py-2 rounded-lg font-semibold">
              Post It!
            </button>
          </div>
        </div>
      )}

      {/* Feed */}
      <div className="p-4">
        {posts.map(post => (
          <PostCard key={post.id} post={post} />
        ))}
      </div>

      {/* Bottom Navigation */}
      <div className="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-md bg-white border-t shadow-lg">
        <div className="flex justify-around py-3">
          <button 
            onClick={() => setCurrentTab('home')}
            className={`flex flex-col items-center space-y-1 ${currentTab === 'home' ? 'text-red-500' : 'text-gray-600'}`}
          >
            <Home className="w-5 h-5" />
            <span className="text-xs">Home</span>
          </button>
          <button 
            onClick={() => setCurrentTab('community')}
            className={`flex flex-col items-center space-y-1 ${currentTab === 'community' ? 'text-red-500' : 'text-gray-600'}`}
          >
            <Users className="w-5 h-5" />
            <span className="text-xs">Community</span>
          </button>
          <button 
            onClick={() => setCurrentTab('growth')}
            className={`flex flex-col items-center space-y-1 ${currentTab === 'growth' ? 'text-red-500' : 'text-gray-600'}`}
          >
            <TrendingUp className="w-5 h-5" />
            <span className="text-xs">Growth</span>
          </button>
        </div>
      </div>

      {/* Bottom spacing for fixed nav */}
      <div className="h-20"></div>
    </div>
  );
};

export default LetsDoItApp;
