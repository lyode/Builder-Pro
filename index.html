<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Builder Pro">
    <meta name="apple-mobile-web-app-title" content="Builder Pro">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#d2bcbf">
    <meta name="msapplication-navbutton-color" content="#d2bcbf">
    <meta name="msapplication-starturl" content="/">
    <meta name="format-detection" content="telephone=no">
    
    <title>Builder Pro 2.1 - AI-Powered Project Manager</title>
    
    <style>
        :root {
            --safe-area-inset-top: env(safe-area-inset-top, 0px);
            --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
            --safe-area-inset-left: env(safe-area-inset-left, 0px);
            --safe-area-inset-right: env(safe-area-inset-right, 0px);
            
            /* Default Theme - Pink/Rose */
            --bg-color: #F4EDEB;
            --accent-color: #d2bcbf;
            --highlight-color: #a67980;
            --text-color: #1C1C1C;
            
            --card-bg: #ffffff;
            --text-secondary: #5a5a5a;
            --border-color: #e8e8e8;
            --shadow-color: rgba(75, 43, 26, 0.08);
            --success: #10b981;
            --warning: #f39c12;
            --danger: #ef4444;
            --income-color: #10b981;
            --expense-color: #ef4444;
            
            --button-primary: #4B2B1A;
            --button-primary-hover: #6B4332;
            
            --contrast: 1;
            --brightness: 1;
            --font-scale: 1;
        }

        /* Theme Color Schemes */
        .theme-rose {
            --accent-color: #d2bcbf;
            --highlight-color: #a67980;
        }

        .theme-sage {
            --accent-color: #c0ccb8;
            --highlight-color: #60665c;
        }

        .theme-gold {
            --accent-color: #e0b558;
            --highlight-color: #ecd299;
        }

        .theme-ocean {
            --accent-color: #99b3ec;
            --highlight-color: #151b73;
        }

        .theme-lavender {
            --accent-color: #8386a4;
            --highlight-color: #191a22;
        }

        .theme-teal {
            --accent-color: #90b2b8;
            --highlight-color: #2c4144;
        }

        .theme-seafoam {
            --accent-color: #9cbbbf;
            --highlight-color: #436266;
        }
        
        body.low-contrast { --contrast: 0.85; --brightness: 1.1; }
        body.normal-contrast { --contrast: 1; --brightness: 1; }
        body.high-contrast { --contrast: 1.25; --brightness: 0.95; }
        body.extra-contrast { --contrast: 1.5; --brightness: 0.9; }
        body { filter: contrast(var(--contrast)) brightness(var(--brightness)); }
        
        body.font-s { --font-scale: 0.85; }
        body.font-m { --font-scale: 1; }
        body.font-l { --font-scale: 1.15; }
        body.font-xl { --font-scale: 1.3; }
        body.font-xxl { --font-scale: 1.5; }

        body.sat-low { filter: saturate(0.7) contrast(var(--contrast)) brightness(var(--brightness)); }
        body.sat-normal { filter: saturate(1) contrast(var(--contrast)) brightness(var(--brightness)); }
        body.sat-high { filter: saturate(1.3) contrast(var(--contrast)) brightness(var(--brightness)); }
        body.sat-vibrant { filter: saturate(1.6) contrast(var(--contrast)) brightness(var(--brightness)); }

        .night-mode { 
            --bg-color: #1a1618 !important; 
            --card-bg: #2d2729 !important; 
            --text-color: #f0f0f0 !important; 
            --text-secondary: #c0c0c8 !important; 
            --border-color: #4a4246 !important; 
            --shadow-color: rgba(0,0,0,0.3) !important;
        }
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: var(--bg-color); 
            color: var(--text-color);
            min-height: 100vh; 
            overflow-x: hidden; 
            transition: all 0.3s; 
            font-size: calc(14px * var(--font-scale));
        }
        
        .app-container { 
            max-width: 100vw; 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column;
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
        
        @media (display-mode: standalone) {
            .fixed-header-section {
                padding-top: max(20px, env(safe-area-inset-top));
            }
            
            .main-content-wrapper {
                margin-top: calc(260px + max(20px, env(safe-area-inset-top)));
            }
        }
        
        @supports (padding-top: max(0px)) {
            .fixed-header-section {
                padding-top: max(20px, env(safe-area-inset-top));
            }
            
            .header {
                padding-top: 12px;
            }
        }
        
        .fixed-header-section {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: var(--bg-color);
            padding-top: var(--safe-area-inset-top);
        }
        
        .header { 
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--highlight-color) 100%); 
            color: white; 
            padding: 10px 12px; 
            box-shadow: 0 2px 10px var(--shadow-color); 
        }
        
        .header-content { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            gap: 10px; 
        }
        
        .header-left { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            flex: 1; 
            cursor: pointer; 
        }
        
        .header h1 { 
            font-size: calc(16px * var(--font-scale)); 
            font-weight: 600; 
        }
        
        .header-subtitle { 
            font-size: calc(11px * var(--font-scale)); 
            opacity: 0.9; 
            margin-top: 2px; 
        }
        
        .header-controls { 
            display: flex; 
            gap: 8px; 
            align-items: center; 
        }
        
        .header-btn { 
            background: rgba(255,255,255,0.2); 
            border: none; 
            color: white; 
            width: 32px; 
            height: 32px; 
            border-radius: 50%; 
            cursor: pointer; 
            font-size: calc(14px * var(--font-scale)); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            position: relative; 
            transition: background 0.2s;
        }
        
        .header-btn:active {
            background: rgba(255,255,255,0.3);
        }
        
        .sync-indicator { 
            position: absolute; 
            top: -2px; 
            right: -2px; 
            width: 8px; 
            height: 8px; 
            background: #10b981; 
            border-radius: 50%; 
            animation: pulse 2s infinite; 
            display: none; 
        }
        
        .sync-indicator.syncing { 
            display: block; 
            background: #f39c12; 
            animation: spin 1s linear infinite; 
        }
        
        @keyframes pulse { 
            0%, 100% { opacity: 1; } 
            50% { opacity: 0.5; } 
        }
        
        @keyframes spin { 
            to { transform: rotate(360deg); } 
        }
        
        .stats-bar { 
            background: white; 
            padding: 10px 12px; 
            display: flex; 
            justify-content: space-around; 
            box-shadow: 0 1px 3px var(--shadow-color); 
        }
        
        .stat-item { 
            text-align: center; 
            flex: 1; 
            padding: 2px;
        }
        
        .stat-value { 
            font-size: calc(16px * var(--font-scale)); 
            font-weight: bold; 
            color: var(--text-color); 
        }
        
        .stat-label { 
            font-size: calc(10px * var(--font-scale)); 
            color: var(--text-secondary); 
            margin-top: 2px; 
        }
        
        .nav-tabs { 
            background: var(--card-bg); 
            display: flex; 
            border-bottom: 1px solid var(--border-color); 
            padding: 0 12px; 
            gap: 20px; 
            overflow-x: auto; 
            scrollbar-width: none;
        }
        
        .nav-tabs::-webkit-scrollbar { display: none; }
        
        .nav-tab { 
            padding: 12px 4px; 
            cursor: pointer; 
            white-space: nowrap; 
            border-bottom: 2px solid transparent; 
            color: var(--text-secondary); 
            transition: all 0.2s; 
            font-size: calc(13px * var(--font-scale)); 
        }
        
        .nav-tab.active { 
            color: var(--highlight-color); 
            border-bottom-color: var(--highlight-color); 
            font-weight: 500; 
        }
        
        .main-content-wrapper {
            margin-top: 260px;
        }
        
        .main-content { 
            flex: 1; 
            padding: 12px; 
            max-width: 100%; 
            overflow-x: hidden; 
            min-height: calc(100vh - 260px);
        }
        
        .section { 
            display: none; 
            animation: fadeIn 0.3s; 
        }
        
        .section.active { 
            display: block; 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; } 
            to { opacity: 1; } 
        }
        
        .add-btn { 
            position: fixed; 
            bottom: calc(20px + env(safe-area-inset-bottom)); 
            right: calc(20px + env(safe-area-inset-right)); 
            background: linear-gradient(135deg, var(--accent-color), var(--highlight-color)); 
            color: white; 
            width: 56px; 
            height: 56px; 
            border-radius: 50%; 
            border: none; 
            font-size: 24px; 
            cursor: pointer; 
            box-shadow: 0 4px 12px var(--shadow-color); 
            z-index: 50; 
            transition: transform 0.2s; 
        }
        
        .add-btn:active { 
            transform: scale(0.95); 
        }
        
        .card { 
            background: var(--card-bg); 
            border-radius: 12px; 
            padding: 14px; 
            margin-bottom: 12px; 
            box-shadow: 0 2px 8px var(--shadow-color); 
            position: relative; 
            overflow: hidden; 
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:active {
            transform: scale(0.99);
        }
        
        .card-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start; 
            margin-bottom: 8px; 
            gap: 10px;
        }
        
        .card-title { 
            font-weight: 600; 
            font-size: calc(14px * var(--font-scale)); 
            color: var(--text-color); 
            word-break: break-word;
            flex: 1; 
        }
        
        .card-meta { 
            font-size: calc(11px * var(--font-scale)); 
            color: var(--text-secondary); 
            margin-top: 4px; 
        }
        
        .card-actions { 
            display: flex; 
            gap: 6px;
            flex-shrink: 0;
        }
        
        .card-btn { 
            background: transparent; 
            border: none; 
            color: var(--text-secondary); 
            cursor: pointer; 
            padding: 6px; 
            border-radius: 50%; 
            font-size: calc(16px * var(--font-scale)); 
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
        }
        
        .card-btn:active { 
            background: var(--border-color); 
        }
        
        .progress-bar { 
            height: 6px; 
            background: var(--border-color); 
            border-radius: 3px; 
            overflow: hidden; 
            margin-top: 10px; 
        }
        
        .progress-fill { 
            height: 100%; 
            background: linear-gradient(90deg, var(--accent-color), var(--highlight-color)); 
            border-radius: 3px; 
            transition: width 0.3s; 
        }
        
        .task-item { 
            display: flex; 
            align-items: center; 
            padding: 8px; 
            background: var(--bg-color); 
            border-radius: 8px; 
            margin-bottom: 6px; 
            gap: 10px;
        }
        
        .task-checkbox { 
            width: 20px; 
            height: 20px; 
            accent-color: var(--highlight-color); 
            flex-shrink: 0; 
        }
        
        .task-text { 
            flex: 1; 
            font-size: calc(13px * var(--font-scale)); 
            word-break: break-word; 
        }
        
        .task-text.completed { 
            text-decoration: line-through; 
            opacity: 0.6; 
        }
        
        .delete-task-btn {
            background: transparent;
            border: none;
            color: var(--danger);
            cursor: pointer;
            padding: 4px;
            font-size: calc(14px * var(--font-scale));
            opacity: 0.7;
        }
        
        .delete-task-btn:active {
            opacity: 1;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--bg-color);
            border-radius: 8px;
            margin-bottom: 6px;
        }
        
        .transaction-amount {
            font-weight: bold;
            font-size: calc(14px * var(--font-scale));
        }
        
        .income { color: var(--income-color); }
        .expense { color: var(--expense-color); }
        
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background: rgba(0,0,0,0.5); 
            z-index: 200; 
            animation: fadeIn 0.2s; 
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
        
        .modal.active { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
        }
        
        .modal-content { 
            background: var(--card-bg); 
            border-radius: 16px; 
            padding: 20px; 
            width: 90%; 
            max-width: 400px; 
            max-height: 80vh; 
            overflow-y: auto; 
            animation: slideUp 0.3s; 
        }
        
        @keyframes slideUp { 
            from { transform: translateY(50px); opacity: 0; } 
            to { transform: translateY(0); opacity: 1; } 
        }
        
        .modal-header { 
            font-size: calc(18px * var(--font-scale)); 
            font-weight: bold; 
            margin-bottom: 16px; 
            color: var(--text-color);
        }
        
        .form-group { 
            margin-bottom: 16px; 
        }
        
        .form-label { 
            display: block; 
            font-size: calc(12px * var(--font-scale)); 
            color: var(--text-secondary); 
            margin-bottom: 6px; 
        }
        
        .form-input, .form-select, .form-textarea { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid var(--border-color); 
            border-radius: 8px; 
            font-size: calc(14px * var(--font-scale)); 
            background: var(--card-bg); 
            color: var(--text-color); 
            transition: border-color 0.2s;
        }
        
        .form-textarea { 
            resize: vertical; 
            min-height: 80px; 
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus { 
            outline: none; 
            border-color: var(--highlight-color); 
        }
        
        .form-actions { 
            display: flex; 
            gap: 10px; 
            margin-top: 20px; 
        }
        
        .btn { 
            flex: 1; 
            padding: 12px; 
            border: none; 
            border-radius: 8px; 
            font-size: calc(14px * var(--font-scale)); 
            font-weight: 500; 
            cursor: pointer; 
            transition: transform 0.2s, opacity 0.2s;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary { 
            background: linear-gradient(135deg, var(--accent-color), var(--highlight-color)); 
            color: white; 
        }
        
        .btn-secondary { 
            background: var(--border-color); 
            color: var(--text-color); 
        }
        
        .empty-state { 
            text-align: center; 
            padding: 60px 20px; 
            color: var(--text-secondary); 
        }
        
        .empty-icon { 
            font-size: 48px; 
            margin-bottom: 16px; 
            opacity: 0.3; 
        }
        
        .empty-text { 
            font-size: calc(14px * var(--font-scale)); 
            line-height: 1.5; 
        }
        
        .toast { 
            position: fixed; 
            bottom: calc(100px + env(safe-area-inset-bottom)); 
            left: 50%; 
            transform: translateX(-50%); 
            background: var(--button-primary); 
            color: white; 
            padding: 12px 20px; 
            border-radius: 20px; 
            font-size: calc(13px * var(--font-scale)); 
            z-index: 300; 
            opacity: 0; 
            transition: opacity 0.3s; 
            pointer-events: none; 
            max-width: 80%; 
            text-align: center; 
        }
        
        .toast.show { 
            opacity: 0.95; 
        }
        
        .settings-group {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .settings-row:last-child {
            border-bottom: none;
        }
        
        .settings-label {
            font-size: calc(14px * var(--font-scale));
            color: var(--text-color);
            flex: 1;
        }
        
        .settings-value {
            font-size: calc(13px * var(--font-scale));
            color: var(--text-secondary);
        }
        
        .switch {
            position: relative;
            width: 48px;
            height: 26px;
            background: var(--border-color);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .switch.active {
            background: var(--highlight-color);
        }
        
        .switch-handle {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .switch.active .switch-handle {
            transform: translateX(22px);
        }
        
        .btn-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .btn-option {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: calc(12px * var(--font-scale));
            transition: all 0.2s;
        }
        
        .btn-option.active {
            background: var(--highlight-color);
            color: white;
            border-color: var(--highlight-color);
        }
        
        #syncStatus {
            padding: 8px 12px;
            background: var(--bg-color);
            border-radius: 8px;
            font-size: calc(11px * var(--font-scale));
            margin-top: 8px;
        }
        
        .currency-note {
            font-size: calc(11px * var(--font-scale));
            color: var(--text-secondary);
            font-style: italic;
            margin-top: 4px;
        }

        /* Sticky Note Styles */
        .sticky-note {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-2deg);
            background: linear-gradient(135deg, #fff9c4 0%, #ffeb3b 100%);
            width: 280px;
            padding: 20px;
            border-radius: 4px;
            box-shadow: 
                0 10px 40px rgba(0,0,0,0.3),
                inset 0 -40px 40px rgba(0,0,0,0.05);
            z-index: 1000;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            animation: popIn 0.4s ease-out, wobble 0.5s ease-in-out 0.4s;
            display: none;
        }

        .sticky-note::before {
            content: '';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 30px;
            background: rgba(255,255,255,0.6);
            border: 1px solid #ddd;
            border-radius: 2px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .sticky-note.show {
            display: block;
        }

        .sticky-note-header {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
            text-decoration: underline;
            text-decoration-style: wavy;
            text-decoration-color: #ff9800;
        }

        .sticky-note-content {
            font-size: 14px;
            color: #333;
            line-height: 1.6;
        }

        .sticky-note-content .check-item {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .sticky-note-content .check-item::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            color: #4caf50;
            font-weight: bold;
        }

        .sticky-note-footer {
            margin-top: 15px;
            font-size: 11px;
            color: #666;
            text-align: center;
            font-style: italic;
        }

        @keyframes popIn {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-2deg);
                opacity: 0;
            }
            70% {
                transform: translate(-50%, -50%) scale(1.1) rotate(-2deg);
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(-2deg);
                opacity: 1;
            }
        }

        @keyframes wobble {
            0%, 100% { transform: translate(-50%, -50%) rotate(-2deg); }
            25% { transform: translate(-50%, -50%) rotate(2deg); }
            75% { transform: translate(-50%, -50%) rotate(-1deg); }
        }

        /* Theme Color Picker */
        .theme-picker {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .theme-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
            overflow: hidden;
        }

        .theme-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            transition: all 0.3s;
        }

        .theme-option::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50%;
            transition: all 0.3s;
        }

        .theme-option.active {
            border-color: var(--text-color);
            transform: scale(1.1);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .theme-option.active::before {
            content: '‚úì';
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            height: 100%;
            background: rgba(0,0,0,0.3) !important;
        }

        .theme-option.active::after {
            display: none;
        }

        /* Individual theme colors for picker */
        .theme-option[data-theme="rose"]::before { background: #d2bcbf; }
        .theme-option[data-theme="rose"]::after { background: #a67980; }

        .theme-option[data-theme="sage"]::before { background: #c0ccb8; }
        .theme-option[data-theme="sage"]::after { background: #60665c; }

        .theme-option[data-theme="gold"]::before { background: #e0b558; }
        .theme-option[data-theme="gold"]::after { background: #ecd299; }

        .theme-option[data-theme="ocean"]::before { background: #99b3ec; }
        .theme-option[data-theme="ocean"]::after { background: #151b73; }

        .theme-option[data-theme="lavender"]::before { background: #8386a4; }
        .theme-option[data-theme="lavender"]::after { background: #191a22; }

        .theme-option[data-theme="teal"]::before { background: #90b2b8; }
        .theme-option[data-theme="teal"]::after { background: #2c4144; }

        .theme-option[data-theme="seafoam"]::before { background: #9cbbbf; }
        .theme-option[data-theme="seafoam"]::after { background: #436266; }

        /* Gantt Chart Styles */
        .gantt-container {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px var(--shadow-color);
            overflow-x: auto;
        }
        
        .gantt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .gantt-title {
            font-weight: 600;
            font-size: calc(16px * var(--font-scale));
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .gantt-controls {
            display: flex;
            gap: 8px;
        }
        
        .gantt-btn {
            padding: 6px 12px;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: calc(12px * var(--font-scale));
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .gantt-btn.active {
            background: var(--highlight-color);
            color: white;
            border-color: var(--highlight-color);
        }
        
        .gantt-chart {
            position: relative;
            min-height: 200px;
            background: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .gantt-grid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }
        
        .gantt-row {
            position: relative;
            height: 40px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
        }
        
        .gantt-label {
            position: absolute;
            left: 10px;
            font-size: calc(12px * var(--font-scale));
            color: var(--text-color);
            white-space: nowrap;
            z-index: 2;
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .gantt-bar {
            position: absolute;
            height: 28px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            padding: 0 8px;
            font-size: calc(11px * var(--font-scale));
            color: white;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            z-index: 1;
        }
        
        .gantt-bar:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .gantt-today-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #ff6b6b;
            z-index: 3;
            pointer-events: none;
        }
        
        .gantt-weekend {
            position: absolute;
            top: 0;
            bottom: 0;
            background: #f0f0f0;
            pointer-events: none;
        }
        
        .mini-gantt {
            height: 100px;
            margin-top: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            position: relative;
            overflow: hidden;
        }
        
        .mini-gantt-bar {
            position: absolute;
            height: 20px;
            border-radius: 3px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        /* AI Assistant Panel */
        .ai-panel {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .ai-panel-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .ai-icon {
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .ai-title {
            font-size: calc(16px * var(--font-scale));
            font-weight: 600;
        }
        
        .ai-suggestions {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
        }
        
        .ai-suggestion {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: calc(13px * var(--font-scale));
        }
        
        .ai-suggestion:last-child {
            border-bottom: none;
        }
        
        .ai-action-btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: calc(12px * var(--font-scale));
            font-weight: 500;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.2s;
        }
        
        .ai-action-btn:hover {
            transform: scale(1.05);
        }
        
        .ai-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-size: 8px;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .nav-tab .ai-indicator {
            position: absolute;
            top: 8px;
            right: -8px;
            width: 6px;
            height: 6px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .task-duration {
            font-size: calc(11px * var(--font-scale));
            color: var(--text-secondary);
            padding: 2px 6px;
            background: var(--bg-color);
            border-radius: 4px;
        }
        
        .date-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .btn-ai {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

    </style>
</head>
<body>
    <div class="app-container">
        <div class="fixed-header-section">
            <header class="header">
                <div class="header-content">
                    <div class="header-left" onclick="goHome()">
                        <div>
                            <h1>üèóÔ∏è Builder Pro</h1>
                            <div class="header-subtitle">AI-Powered Project Manager</div>
                        </div>
                    </div>
                    <div class="header-controls">
                                                <button class="header-btn" onclick="showAIAssistant()" title="AI Assistant">
                            ü§ñ
                            <span class="ai-badge">AI</span>
                        </button>
                        <button class="header-btn" onclick="performSync()" title="Sync">
                            ‚òÅÔ∏è
                            <span class="sync-indicator" id="syncIndicator"></span>
                        </button>
                        <button class="header-btn" onclick="showTrash()" title="Trash">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            </header>
            
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="projectCount">0</div>
                    <div class="stat-label">Projects</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="taskCount">0</div>
                    <div class="stat-label">Tasks</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="completionRate">0%</div>
                    <div class="stat-label">Complete</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalBalance">$0</div>
                    <div class="stat-label">Balance</div>
                </div>
            </div>
            
            <nav class="nav-tabs">
                <div class="nav-tab active" onclick="switchView('projects')">Projects</div>
                <div class="nav-tab" onclick="switchView('tasks')">Tasks</div>
                <div class="nav-tab" onclick="switchView('schedule')">
                    Schedule
                    <span class="ai-indicator"></span>
                </div>
                <div class="nav-tab" onclick="switchView('financial')">Financial</div>
                <div class="nav-tab" onclick="switchView('settings')">Settings</div>
            </nav>
        </div>
        
        <div class="main-content-wrapper">
            <main class="main-content">
                <div id="projectsSection" class="section active"></div>
                <div id="tasksSection" class="section"></div>
                                <div id="scheduleSection" class="section"></div>
                <div id="financialSection" class="section"></div>
                <div id="settingsSection" class="section"></div>
            </main>
        </div>
        
        <button class="add-btn" id="addBtn" onclick="openAddModal()">+</button>
    </div>
    
    <!-- Modals -->
    <div id="addProjectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">New Project</div>
            <div class="form-group">
                <label class="form-label">Project Name</label>
                <input type="text" class="form-input" id="projectName" placeholder="Enter project name">
            </div>
            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-textarea" id="projectDescription" placeholder="Project description (optional)"></textarea>
            </div>
                        <div class="form-group">
                <label class="form-label">Project Dates</label>
                <div class="date-inputs">
                    <input type="date" class="form-input" id="projectStartDate">
                    <input type="date" class="form-input" id="projectEndDate">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Budget (optional)</label>
                <input type="number" class="form-input" id="projectBudget" placeholder="0.00">
                <div class="currency-note">Currency: <span id="currencyDisplay">USD</span></div>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeModal('addProjectModal')">Cancel</button>
                                <button class="btn btn-ai" onclick="generateAIProject()">ü§ñ AI Generate</button>
                <button class="btn btn-primary" onclick="saveProject()">Create</button>
            </div>
        </div>
    </div>
    
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">New Task</div>
            <div class="form-group">
                <label class="form-label">Task Description</label>
                <input type="text" class="form-input" id="taskDescription" placeholder="What needs to be done?">
            </div>
            <div class="form-group">
                <label class="form-label">Project</label>
                <select class="form-select" id="taskProject"></select>
            </div>
            <div class="form-group">
                <label class="form-label">Duration (days)</label>
                <input type="number" class="form-input" id="taskDuration" placeholder="1" value="1" min="1">
            </div>
            <div class="form-group">
                <label class="form-label">Priority</label>
                <select class="form-select" id="taskPriority">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                </select>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeModal('addTaskModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveTask()">Add Task</button>
            </div>
        </div>
    </div>
    
    <div id="addTransactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">New Transaction</div>
            <div class="form-group">
                <label class="form-label">Type</label>
                <select class="form-select" id="transactionType">
                    <option value="income">Income</option>
                    <option value="expense">Expense</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Amount</label>
                <input type="number" class="form-input" id="transactionAmount" placeholder="0.00" step="0.01">
            </div>
            <div class="form-group">
                <label class="form-label">Description</label>
                <input type="text" class="form-input" id="transactionDescription" placeholder="What is this for?">
            </div>
            <div class="form-group">
                <label class="form-label">Project</label>
                <select class="form-select" id="transactionProject">
                    <option value="">No Project</option>
                </select>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeModal('addTransactionModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveTransaction()">Add</button>
            </div>
        </div>
    </div>
    
        
    <div id="aiAssistantModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">ü§ñ AI Assistant</div>
            <div class="ai-panel" style="margin: 0; box-shadow: none;">
                <div class="ai-suggestions">
                    <div id="aiSuggestionsList"></div>
                </div>
                <button class="ai-action-btn" onclick="generateSmartSchedule()">Generate Smart Schedule</button>
                <button class="ai-action-btn" onclick="optimizeProjectTimeline()">Optimize Timeline</button>
                <button class="ai-action-btn" onclick="analyzeBudgetHealth()">Analyze Budget Health</button>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeModal('aiAssistantModal')">Close</button>
            </div>
        </div>
    </div>
    
    <div id="trashModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">üóëÔ∏è Trash</div>
            <div id="trashContent"></div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeModal('trashModal')">Close</button>
                <button class="btn btn-primary" onclick="emptyTrash()">Empty Trash</button>
            </div>
        </div>
    </div>
    
    <div id="toast" class="toast"></div>

    <!-- Sticky Note Reminder -->
    <div id="stickyNote" class="sticky-note">
        <div class="sticky-note-header">üìå Quick Check!</div>
        <div class="sticky-note-content" id="stickyNoteContent">
            <!-- Content will be dynamically generated -->
        </div>
        <div class="sticky-note-footer">Auto-closing in 5 seconds...</div>
    </div>
    
    <script>
        // Data structure
        let data = {
            projects: [],
            tasks: [],
            transactions: [],
            trash: [],
            permanentlyDeleted: [],
            settings: {
                nightMode: false,
                currency: 'USD',
                contrast: 'normal',
                fontSize: 'm',
                saturation: 'normal',
                theme: 'rose'
            }
        };
        
        // App state
        let currentView = 'projects';
        let syncApiKey = '';
        let reminderInterval = null;
        let apiTempDisabled = false;
        
        // App configuration
        const APP_CONFIG = {
            baseUrl: 'https://api.jsonbin.io/v3',
            binId: '678e017dacd3cb34a8c57f18'
        };
        
        // Initialize app
        function init() {
            loadData();
            // Clear all data as requested
            clearAllInitialData();
            
            applySettings();
            renderView();
            updateStats();
            checkSyncStatus();
            setupReminderSystem();
            
            // Load API key from localStorage
            const savedApiKey = localStorage.getItem('builderProSyncApiKey');
            if (savedApiKey) {
                syncApiKey = savedApiKey;
                document.getElementById('syncMode').textContent = 'Ready';
            }
            
            // Check if launched as PWA
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('Running as PWA');
            }
            
            // Auto-sync on load if API key exists
            if (syncApiKey && navigator.onLine) {
                setTimeout(() => performSync(), 2000);
            }
        }
        
        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('builderProData');
            if (saved) {
                try {
                    data = JSON.parse(saved);
                    // Ensure all properties exist
                    data.projects = data.projects || [];
                    data.tasks = data.tasks || [];
                    data.transactions = data.transactions || [];
                    data.trash = data.trash || [];
                    data.permanentlyDeleted = data.permanentlyDeleted || [];
                    data.settings = data.settings || {
                        nightMode: false,
                        currency: 'USD',
                        contrast: 'normal',
                        fontSize: 'm',
                        saturation: 'normal',
                        theme: 'rose'
                    };
                    // Ensure theme setting exists
                    if (!data.settings.theme) {
                        data.settings.theme = 'rose';
                    }
                } catch (e) {
                    console.error('Error loading data:', e);
                }
            }
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('builderProData', JSON.stringify(data));
        }
        
        // Apply settings
        function applySettings() {
            document.body.classList.toggle('night-mode', data.settings.nightMode);
            
            // Remove all theme classes
            document.body.classList.remove('theme-rose', 'theme-sage', 'theme-gold', 
                                          'theme-ocean', 'theme-lavender', 'theme-teal', 'theme-seafoam');
            // Add current theme
            document.body.classList.add('theme-' + data.settings.theme);
            
            // Update theme color meta tag
            const themeColors = {
                rose: '#d2bcbf',
                sage: '#c0ccb8',
                gold: '#e0b558',
                ocean: '#99b3ec',
                lavender: '#8386a4',
                teal: '#90b2b8',
                seafoam: '#9cbbbf'
            };
            document.querySelector('meta[name="theme-color"]').content = themeColors[data.settings.theme];
            
            // Contrast settings
            document.body.classList.remove('low-contrast', 'normal-contrast', 'high-contrast', 'extra-contrast');
            document.body.classList.add(data.settings.contrast + '-contrast');
            
            // Font size settings
            document.body.classList.remove('font-s', 'font-m', 'font-l', 'font-xl', 'font-xxl');
            document.body.classList.add('font-' + data.settings.fontSize);
            
            // Saturation settings
            document.body.classList.remove('sat-low', 'sat-normal', 'sat-high', 'sat-vibrant');
            document.body.classList.add('sat-' + data.settings.saturation);
        }
        
        // Switch view
        function switchView(view) {
            currentView = view;
            
            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(view + 'Section').classList.add('active');
            
            // Update add button visibility
            document.getElementById('addBtn').style.display = 
                (view === 'settings' || view === 'schedule') ? 'none' : 'block';
            
            renderView();
        }
        
        // Go home
        function goHome() {
            currentView = 'projects';
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector('.nav-tab').classList.add('active');
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('projectsSection').classList.add('active');
            
            renderView();
        }
        
        // Render current view
        function renderView() {
            switch(currentView) {
                case 'projects':
                    renderProjects();
                    break;
                case 'tasks':
                    renderTasks();
                    break;
                
                case 'schedule':
                    renderSchedule();
                    break;
                case 'financial':
                    renderFinancial();
                    break;
                case 'settings':
                    renderSettings();
                    break;
            }
        }
        
        // Render projects
        function renderProjects() {
            const container = document.getElementById('projectsSection');
            const projects = data.projects.filter(p => !p.deleted);
            
            if (projects.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìÅ</div>
                        <div class="empty-text">No projects yet<br>Tap + to create your first project</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = projects.map(project => {
                const tasks = data.tasks.filter(t => t.projectId === project.id && !t.deleted);
                const completed = tasks.filter(t => t.completed).length;
                const progress = tasks.length > 0 ? (completed / tasks.length * 100) : 0;
                
                const transactions = data.transactions.filter(t => t.projectId === project.id && !t.deleted);
                const income = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                const expenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                const balance = income - expenses;
                
                return `
                    <div class="card" onclick="viewProject('${project.id}')">
                        <div class="card-header">
                            <div>
                                <div class="card-title">${project.name}</div>
                                <div class="card-meta">
                                    ${tasks.length} tasks ‚Ä¢ ${getCurrencySymbol()}${balance.toFixed(2)}
                                    ${project.budget ? ` ‚Ä¢ Budget: ${getCurrencySymbol()}${project.budget}` : ''}
                                </div>
                            </div>
                            <div class="card-actions">
                                <button class="card-btn" onclick="event.stopPropagation(); deleteProject('${project.id}')">üóëÔ∏è</button>
                            </div>
                        </div>
                        ${project.description ? `<div class="card-meta">${project.description}</div>` : ''}
                        ${tasks.length > 0 ? `
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }
        
        // View project details
        function viewProject(projectId) {
            const project = data.projects.find(p => p.id === projectId);
            if (!project) return;
            
            const tasks = data.tasks.filter(t => t.projectId === projectId && !t.deleted);
            const transactions = data.transactions.filter(t => t.projectId === projectId && !t.deleted);
            
            const container = document.getElementById('projectsSection');
            container.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">${project.name}</div>
                            <div class="card-meta">Created: ${new Date(project.created).toLocaleDateString()}</div>
                        </div>
                        <button class="card-btn" onclick="renderProjects()">‚Üê</button>
                    </div>
                    ${project.description ? `<div class="card-meta">${project.description}</div>` : ''}
                </div>
                
                <div class="card">
                    <div class="card-title">Tasks (${tasks.length})</div>
                    ${tasks.length > 0 ? tasks.map(task => `
                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" 
                                   ${task.completed ? 'checked' : ''} 
                                   onchange="toggleTask('${task.id}')">
                            <span class="task-text ${task.completed ? 'completed' : ''}">${task.description}</span>
                            <button class="delete-task-btn" onclick="deleteTask('${task.id}')">√ó</button>
                        </div>
                    `).join('') : '<div class="card-meta">No tasks yet</div>'}
                    <button class="btn btn-primary" style="margin-top: 10px" 
                            onclick="openAddTaskForProject('${projectId}')">Add Task</button>
                </div>
                
                <div class="card">
                    <div class="card-title">Transactions</div>
                    ${transactions.length > 0 ? transactions.map(t => `
                        <div class="transaction-item">
                            <div>
                                <div class="${t.type}">${getCurrencySymbol()}${t.amount.toFixed(2)}</div>
                                <div class="card-meta">${t.description}</div>
                            </div>
                            <div class="card-meta">${new Date(t.date).toLocaleDateString()}</div>
                        </div>
                    `).join('') : '<div class="card-meta">No transactions yet</div>'}
                </div>
            `;
        }
        
        // Render tasks
        function renderTasks() {
            const container = document.getElementById('tasksSection');
            const tasks = data.tasks.filter(t => !t.deleted);
            
            if (tasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚úÖ</div>
                        <div class="empty-text">No tasks yet<br>Create a project first, then add tasks</div>
                    </div>
                `;
                return;
            }
            
            // Group tasks by project
            const grouped = {};
            tasks.forEach(task => {
                const project = data.projects.find(p => p.id === task.projectId);
                if (project) {
                    if (!grouped[project.name]) {
                        grouped[project.name] = [];
                    }
                    grouped[project.name].push(task);
                }
            });
            
            container.innerHTML = Object.entries(grouped).map(([projectName, tasks]) => `
                <div class="card">
                    <div class="card-title">${projectName}</div>
                    ${tasks.map(task => `
                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" 
                                   ${task.completed ? 'checked' : ''} 
                                   onchange="toggleTask('${task.id}')">
                            <span class="task-text ${task.completed ? 'completed' : ''}">${task.description}</span>
                            <button class="delete-task-btn" onclick="deleteTask('${task.id}')">√ó</button>
                        </div>
                    `).join('')}
                </div>
            `).join('');
        }
        
        // Render financial
        function renderFinancial() {
            const container = document.getElementById('financialSection');
            const transactions = data.transactions.filter(t => !t.deleted);
            
            const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = totalIncome - totalExpenses;
            
            container.innerHTML = `
                <div class="card">
                    <div class="card-title">Summary</div>
                    <div class="transaction-item">
                        <span>Total Income</span>
                        <span class="income">${getCurrencySymbol()}${totalIncome.toFixed(2)}</span>
                    </div>
                    <div class="transaction-item">
                        <span>Total Expenses</span>
                        <span class="expense">${getCurrencySymbol()}${totalExpenses.toFixed(2)}</span>
                    </div>
                    <div class="transaction-item">
                        <span><strong>Balance</strong></span>
                        <span class="${balance >= 0 ? 'income' : 'expense'}">
                            <strong>${getCurrencySymbol()}${balance.toFixed(2)}</strong>
                        </span>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">Recent Transactions</div>
                    ${transactions.length > 0 ? transactions.slice(-10).reverse().map(t => {
                        const project = data.projects.find(p => p.id === t.projectId);
                        return `
                            <div class="transaction-item">
                                <div>
                                    <div class="${t.type}">${getCurrencySymbol()}${t.amount.toFixed(2)}</div>
                                    <div class="card-meta">${t.description}</div>
                                    ${project ? `<div class="card-meta">${project.name}</div>` : ''}
                                </div>
                                <div>
                                    <div class="card-meta">${new Date(t.date).toLocaleDateString()}</div>
                                    <button class="card-btn" onclick="deleteTransaction('${t.id}')">üóëÔ∏è</button>
                                </div>
                            </div>
                        `;
                    }).join('') : '<div class="card-meta">No transactions yet</div>'}
                </div>
            `;
        }
        
        // Render settings
        function renderSettings() {
            const container = document.getElementById('settingsSection');
            container.innerHTML = `
                <div class="settings-group">
                    <div class="settings-row">
                        <span class="settings-label">Night Mode</span>
                        <div class="switch ${data.settings.nightMode ? 'active' : ''}" 
                             onclick="toggleSetting('nightMode')">
                            <div class="switch-handle"></div>
                        </div>
                    </div>
                    
                    <div class="settings-row">
                        <span class="settings-label">Theme Color</span>
                    </div>
                    <div class="theme-picker">
                        <div class="theme-option ${data.settings.theme === 'rose' ? 'active' : ''}" 
                             data-theme="rose" onclick="setTheme('rose')"></div>
                        <div class="theme-option ${data.settings.theme === 'sage' ? 'active' : ''}" 
                             data-theme="sage" onclick="setTheme('sage')"></div>
                        <div class="theme-option ${data.settings.theme === 'gold' ? 'active' : ''}" 
                             data-theme="gold" onclick="setTheme('gold')"></div>
                        <div class="theme-option ${data.settings.theme === 'ocean' ? 'active' : ''}" 
                             data-theme="ocean" onclick="setTheme('ocean')"></div>
                        <div class="theme-option ${data.settings.theme === 'lavender' ? 'active' : ''}" 
                             data-theme="lavender" onclick="setTheme('lavender')"></div>
                        <div class="theme-option ${data.settings.theme === 'teal' ? 'active' : ''}" 
                             data-theme="teal" onclick="setTheme('teal')"></div>
                        <div class="theme-option ${data.settings.theme === 'seafoam' ? 'active' : ''}" 
                             data-theme="seafoam" onclick="setTheme('seafoam')"></div>
                    </div>
                    
                    <div class="settings-row">
                        <span class="settings-label">Contrast</span>
                    </div>
                    <div class="btn-group">
                        <button class="btn-option ${data.settings.contrast === 'low' ? 'active' : ''}" 
                                onclick="setSetting('contrast', 'low')">Low</button>
                        <button class="btn-option ${data.settings.contrast === 'normal' ? 'active' : ''}" 
                                onclick="setSetting('contrast', 'normal')">Normal</button>
                        <button class="btn-option ${data.settings.contrast === 'high' ? 'active' : ''}" 
                                onclick="setSetting('contrast', 'high')">High</button>
                        <button class="btn-option ${data.settings.contrast === 'extra' ? 'active' : ''}" 
                                onclick="setSetting('contrast', 'extra')">Extra</button>
                    </div>
                    
                    <div class="settings-row">
                        <span class="settings-label">Font Size</span>
                    </div>
                    <div class="btn-group">
                        <button class="btn-option ${data.settings.fontSize === 's' ? 'active' : ''}" 
                                onclick="setSetting('fontSize', 's')">S</button>
                        <button class="btn-option ${data.settings.fontSize === 'm' ? 'active' : ''}" 
                                onclick="setSetting('fontSize', 'm')">M</button>
                        <button class="btn-option ${data.settings.fontSize === 'l' ? 'active' : ''}" 
                                onclick="setSetting('fontSize', 'l')">L</button>
                        <button class="btn-option ${data.settings.fontSize === 'xl' ? 'active' : ''}" 
                                onclick="setSetting('fontSize', 'xl')">XL</button>
                        <button class="btn-option ${data.settings.fontSize === 'xxl' ? 'active' : ''}" 
                                onclick="setSetting('fontSize', 'xxl')">XXL</button>
                    </div>
                    
                    <div class="settings-row">
                        <span class="settings-label">Color Saturation</span>
                    </div>
                    <div class="btn-group">
                        <button class="btn-option ${data.settings.saturation === 'low' ? 'active' : ''}" 
                                onclick="setSetting('saturation', 'low')">Low</button>
                        <button class="btn-option ${data.settings.saturation === 'normal' ? 'active' : ''}" 
                                onclick="setSetting('saturation', 'normal')">Normal</button>
                        <button class="btn-option ${data.settings.saturation === 'high' ? 'active' : ''}" 
                                onclick="setSetting('saturation', 'high')">High</button>
                        <button class="btn-option ${data.settings.saturation === 'vibrant' ? 'active' : ''}" 
                                onclick="setSetting('saturation', 'vibrant')">Vibrant</button>
                    </div>
                    
                    <div class="settings-row">
                        <span class="settings-label">Currency</span>
                        <select class="form-select" style="width: auto" onchange="setCurrency(this.value)">
                            <option value="USD" ${data.settings.currency === 'USD' ? 'selected' : ''}>USD ($)</option>
                            <option value="EUR" ${data.settings.currency === 'EUR' ? 'selected' : ''}>EUR (‚Ç¨)</option>
                            <option value="GBP" ${data.settings.currency === 'GBP' ? 'selected' : ''}>GBP (¬£)</option>
                            <option value="JPY" ${data.settings.currency === 'JPY' ? 'selected' : ''}>JPY (¬•)</option>
                            <option value="CNY" ${data.settings.currency === 'CNY' ? 'selected' : ''}>CNY (¬•)</option>
                            <option value="INR" ${data.settings.currency === 'INR' ? 'selected' : ''}>INR (‚Çπ)</option>
                            <option value="MYR" ${data.settings.currency === 'MYR' ? 'selected' : ''}>MYR (RM)</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-group">
                    <div class="card-title">Cloud Sync (JSONBin.io)</div>
                    <div id="syncStatus">
                        <div>Status: <span id="syncMode">Not configured</span></div>
                        <div id="lastSyncTime"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">API Key (from jsonbin.io)</label>
                        <input type="password" class="form-input" id="apiKeyInput" 
                               placeholder="Enter your JSONBin API key">
                    </div>
                    <button class="btn btn-primary" onclick="saveApiKey()">Save API Key</button>
                    <button class="btn btn-secondary" onclick="testSync()" style="margin-top: 8px">Test Connection</button>
                </div>
                
                <div class="settings-group">
                    <div class="card-title">Data Management</div>
                    <button class="btn btn-secondary" onclick="exportData()">Export Data</button>
                    <input type="file" id="importFile" accept=".json" style="display: none" onchange="importData(event)">
                    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()" 
                            style="margin-top: 8px">Import Data</button>
                    <button class="btn btn-secondary" onclick="showTrash()" style="margin-top: 8px">
                        View Trash (${data.trash.length} items)
                    </button>
                </div>
                
                <div class="settings-group">
                    <div class="card-title">About</div>
                    <div class="card-meta">
                        Builder Pro v2.0<br>
                        AI-Powered Project Manager<br>
                        ¬© 2025 - All rights reserved
                    </div>
                </div>
            `;
        }
        
        // Toggle setting
        function toggleSetting(setting) {
            data.settings[setting] = !data.settings[setting];
            saveData();
            applySettings();
            renderSettings();
        }
        
        // Set setting
        function setSetting(setting, value) {
            data.settings[setting] = value;
            saveData();
            applySettings();
            renderSettings();
        }
        
        // Set theme
        function setTheme(theme) {
            data.settings.theme = theme;
            saveData();
            applySettings();
            renderSettings();
        }
        
        // Set currency
        function setCurrency(currency) {
            data.settings.currency = currency;
            saveData();
            renderView();
            updateStats();
        }
        
        // Get currency symbol
        function getCurrencySymbol() {
            const symbols = {
                USD: '$',
                EUR: '‚Ç¨',
                GBP: '¬£',
                JPY: '¬•',
                CNY: '¬•',
                INR: '‚Çπ',
                MYR: 'RM'
            };
            return symbols[data.settings.currency] || '$';
        }
        
        // Update stats
        function updateStats() {
            const projects = data.projects.filter(p => !p.deleted);
            const tasks = data.tasks.filter(t => !t.deleted);
            const completedTasks = tasks.filter(t => t.completed);
            const transactions = data.transactions.filter(t => !t.deleted);
            
            const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = totalIncome - totalExpenses;
            
            document.getElementById('projectCount').textContent = projects.length;
            document.getElementById('taskCount').textContent = tasks.length;
            document.getElementById('completionRate').textContent = 
                tasks.length > 0 ? Math.round(completedTasks.length / tasks.length * 100) + '%' : '0%';
            document.getElementById('totalBalance').textContent = 
                getCurrencySymbol() + balance.toFixed(0);
        }
        
        // Open add modal
        function openAddModal() {
            switch(currentView) {
                case 'projects':
                    openModal('addProjectModal');
                    document.getElementById('currencyDisplay').textContent = data.settings.currency;
                    break;
                case 'tasks':
                    if (data.projects.filter(p => !p.deleted).length === 0) {
                        showToast('Create a project first');
                        return;
                    }
                    openAddTaskModal();
                    break;
                case 'financial':
                    openAddTransactionModal();
                    break;
            }
        }
        
        // Open add task modal
        function openAddTaskModal() {
            const select = document.getElementById('taskProject');
            select.innerHTML = data.projects.filter(p => !p.deleted).map(p => 
                `<option value="${p.id}">${p.name}</option>`
            ).join('');
            openModal('addTaskModal');
        }
        
        // Open add task for specific project
        function openAddTaskForProject(projectId) {
            const select = document.getElementById('taskProject');
            select.innerHTML = data.projects.filter(p => !p.deleted).map(p => 
                `<option value="${p.id}" ${p.id === projectId ? 'selected' : ''}>${p.name}</option>`
            ).join('');
            openModal('addTaskModal');
        }
        
        // Open add transaction modal
        function openAddTransactionModal() {
            const select = document.getElementById('transactionProject');
            select.innerHTML = '<option value="">No Project</option>' + 
                data.projects.filter(p => !p.deleted).map(p => 
                    `<option value="${p.id}">${p.name}</option>`
                ).join('');
            openModal('addTransactionModal');
        }
        
        // Open modal
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }
        
        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            // Clear inputs
            document.querySelectorAll(`#${modalId} input, #${modalId} textarea`).forEach(input => {
                input.value = '';
            });
        }
        
        // Save project
        function saveProject() {
            const name = document.getElementById('projectName').value.trim();
            const description = document.getElementById('projectDescription').value.trim();
            const budget = parseFloat(document.getElementById('projectBudget').value) || 0;
            
            if (!name) {
                showToast('Please enter a project name');
                return;
            }
            
            const project = {
                id: Date.now().toString(),
                name,
                description,
                budget,
                created: Date.now(),
                updated: Date.now()
            };
            
            data.projects.push(project);
            saveData();
            closeModal('addProjectModal');
            renderProjects();
            updateStats();
            showToast('Project created');
        }
        
        // Save task
        function saveTask() {
            const description = document.getElementById('taskDescription').value.trim();
            const projectId = document.getElementById('taskProject').value;
            
            if (!description) {
                showToast('Please enter task description');
                return;
            }
            
            const task = {
                id: Date.now().toString(),
                description,
                projectId,
                completed: false,
                created: Date.now(),
                updated: Date.now()
            };
            
            data.tasks.push(task);
            saveData();
            closeModal('addTaskModal');
            renderView();
            updateStats();
            showToast('Task added');
        }
        
        // Save transaction
        function saveTransaction() {
            const type = document.getElementById('transactionType').value;
            const amount = parseFloat(document.getElementById('transactionAmount').value);
            const description = document.getElementById('transactionDescription').value.trim();
            const projectId = document.getElementById('transactionProject').value;
            
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount');
                return;
            }
            
            if (!description) {
                showToast('Please enter a description');
                return;
            }
            
            const transaction = {
                id: Date.now().toString(),
                type,
                amount,
                description,
                projectId,
                date: Date.now()
            };
            
            data.transactions.push(transaction);
            saveData();
            closeModal('addTransactionModal');
            renderFinancial();
            updateStats();
            showToast('Transaction added');
        }
        
        // Toggle task
        function toggleTask(taskId) {
            const task = data.tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                task.updated = Date.now();
                saveData();
                renderView();
                updateStats();
            }
        }
        
        // Delete project
        function deleteProject(projectId) {
            if (!confirm('Delete this project and all its tasks/transactions?')) return;
            
            const project = data.projects.find(p => p.id === projectId);
            if (project) {
                project.deleted = true;
                project.deletedAt = Date.now();
                data.trash.push({ type: 'project', item: project });
                
                // Also delete related tasks and transactions
                data.tasks.filter(t => t.projectId === projectId).forEach(task => {
                    task.deleted = true;
                    task.deletedAt = Date.now();
                    data.trash.push({ type: 'task', item: task });
                });
                
                data.transactions.filter(t => t.projectId === projectId).forEach(transaction => {
                    transaction.deleted = true;
                    transaction.deletedAt = Date.now();
                    data.trash.push({ type: 'transaction', item: transaction });
                });
                
                saveData();
                renderProjects();
                updateStats();
                showToast('Project moved to trash');
            }
        }
        
        // Delete task
        function deleteTask(taskId) {
            const task = data.tasks.find(t => t.id === taskId);
            if (task) {
                task.deleted = true;
                task.deletedAt = Date.now();
                data.trash.push({ type: 'task', item: task });
                saveData();
                renderView();
                updateStats();
                showToast('Task deleted');
            }
        }
        
        // Delete transaction
        function deleteTransaction(transactionId) {
            const transaction = data.transactions.find(t => t.id === transactionId);
            if (transaction) {
                transaction.deleted = true;
                transaction.deletedAt = Date.now();
                data.trash.push({ type: 'transaction', item: transaction });
                saveData();
                renderFinancial();
                updateStats();
                showToast('Transaction deleted');
            }
        }
        
        // Show trash
        function showTrash() {
            const modal = document.getElementById('trashModal');
            const content = document.getElementById('trashContent');
            
            if (data.trash.length === 0) {
                content.innerHTML = '<div class="empty-state"><div class="empty-text">Trash is empty</div></div>';
            } else {
                content.innerHTML = data.trash.map(item => {
                    const deletedDate = new Date(item.item.deletedAt).toLocaleDateString();
                    return `
                        <div class="task-item">
                            <div style="flex: 1">
                                <div>${item.type}: ${item.item.name || item.item.description}</div>
                                <div class="card-meta">Deleted: ${deletedDate}</div>
                            </div>
                            <button class="btn btn-primary" onclick="restoreItem('${item.item.id}', '${item.type}')">
                                Restore
                            </button>
                        </div>
                    `;
                }).join('');
            }
            
            openModal('trashModal');
        }
        
        // Restore item
        function restoreItem(itemId, type) {
            let item;
            switch(type) {
                case 'project':
                    item = data.projects.find(p => p.id === itemId);
                    break;
                case 'task':
                    item = data.tasks.find(t => t.id === itemId);
                    break;
                case 'transaction':
                    item = data.transactions.find(t => t.id === itemId);
                    break;
            }
            
            if (item) {
                delete item.deleted;
                delete item.deletedAt;
                data.trash = data.trash.filter(t => t.item.id !== itemId);
                saveData();
                showTrash();
                renderView();
                updateStats();
                showToast('Item restored');
            }
        }
        
        // Empty trash
        function emptyTrash() {
            if (!confirm('Permanently delete all items in trash?')) return;
            
            // Move items to permanently deleted for record keeping
            data.trash.forEach(item => {
                data.permanentlyDeleted.push({
                    ...item,
                    permanentlyDeletedAt: Date.now()
                });
            });
            
            // Remove from main arrays
            const trashIds = data.trash.map(t => t.item.id);
            data.projects = data.projects.filter(p => !trashIds.includes(p.id));
            data.tasks = data.tasks.filter(t => !trashIds.includes(t.id));
            data.transactions = data.transactions.filter(t => !trashIds.includes(t.id));
            
            data.trash = [];
            saveData();
            closeModal('trashModal');
            renderView();
            updateStats();
            showToast('Trash emptied');
        }
        
        // Show toast
        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }
        
        // Check sync status
        function checkSyncStatus() {
            const lastSync = localStorage.getItem('lastSyncTime');
            if (lastSync) {
                const date = new Date(parseInt(lastSync));
                document.getElementById('lastSyncTime').textContent = 
                    `Last: ${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
            }
        }
        
        // Perform sync (temporarily disabled for Builder Pro 2.0 development)
        async function performSync() {
            if (apiTempDisabled) {
                showToast('üîß Sync temporarily disabled for Builder Pro 2.0 development', 4000);
                return;
            }
            
            if (!syncApiKey) {
                showToast('‚ö†Ô∏è No API key set! Go to Settings.');
                return;
            }
            
            const indicator = document.getElementById('syncIndicator');
            const syncMode = document.getElementById('syncMode');
            indicator.classList.add('syncing');
            syncMode.textContent = 'Syncing...';
            
            const startTime = Date.now();
            
            try {
                console.log('üîÑ Starting sync process...');
                
                // STEP 1: FETCH cloud data
                console.log('üîÑ Step 1: Fetching cloud data...');
                syncMode.textContent = 'Fetching...';
                const getResponse = await fetch(`${APP_CONFIG.baseUrl}/b/${APP_CONFIG.binId}/latest`, {
                    headers: {
                        'X-Master-Key': syncApiKey
                    }
                });
                
                if (!getResponse.ok) {
                    throw new Error(`Fetch failed: ${getResponse.status} - ${getResponse.statusText}`);
                }
                
                const cloudResult = await getResponse.json();
                const cloudData = cloudResult.record || {};
                
                // STEP 2: MERGE data intelligently
                console.log('üîÑ Step 2: Merging data...');
                syncMode.textContent = 'Merging...';
                
                if (cloudData.projects || cloudData.tasks || cloudData.transactions) {
                    const beforeCounts = {
                        projects: data.projects.length,
                        tasks: data.tasks.length,
                        transactions: data.transactions.length
                    };
                    
                    // Merge projects
                    if (cloudData.projects) {
                        const localIds = new Set(data.projects.map(p => p.id));
                        const newProjects = cloudData.projects.filter(p => !localIds.has(p.id));
                        data.projects = [...data.projects, ...newProjects];
                        
                        // Update existing projects if cloud version is newer
                        cloudData.projects.forEach(cloudProject => {
                            const localIndex = data.projects.findIndex(p => p.id === cloudProject.id);
                            if (localIndex !== -1) {
                                const localProject = data.projects[localIndex];
                                if (cloudProject.updated > localProject.updated) {
                                    data.projects[localIndex] = cloudProject;
                                }
                            }
                        });
                    }
                    
                    // Merge tasks
                    if (cloudData.tasks) {
                        const localIds = new Set(data.tasks.map(t => t.id));
                        const newTasks = cloudData.tasks.filter(t => !localIds.has(t.id));
                        data.tasks = [...data.tasks, ...newTasks];
                        
                        cloudData.tasks.forEach(cloudTask => {
                            const localIndex = data.tasks.findIndex(t => t.id === cloudTask.id);
                            if (localIndex !== -1) {
                                const localTask = data.tasks[localIndex];
                                if (cloudTask.updated > localTask.updated) {
                                    data.tasks[localIndex] = cloudTask;
                                }
                            }
                        });
                    }
                    
                    // Merge transactions
                    if (cloudData.transactions) {
                        const localIds = new Set(data.transactions.map(t => t.id));
                        const newTransactions = cloudData.transactions.filter(t => !localIds.has(t.id));
                        data.transactions = [...data.transactions, ...newTransactions];
                    }
                    
                    // Merge trash
                    if (cloudData.trash) {
                        data.trash = [
                            ...(data.trash || []),
                            ...cloudData.trash
                        ];
                        data.trash = Array.from(
                            new Map(data.trash.map(item => [item.item.id, item])).values()
                        );
                    }
                    
                    // Merge permanently deleted
                    if (cloudData.permanentlyDeleted) {
                        data.permanentlyDeleted = [
                            ...(data.permanentlyDeleted || []),
                            ...cloudData.permanentlyDeleted
                        ];
                        data.permanentlyDeleted = Array.from(
                            new Map(data.permanentlyDeleted.map(item => [item.id, item])).values()
                        );
                    }
                    
                    const afterCounts = {
                        projects: data.projects.length,
                        tasks: data.tasks.length,
                        transactions: data.transactions.length
                    };
                    
                    // Show what changed during merge
                    const changes = [];
                    if (afterCounts.projects !== beforeCounts.projects) {
                        changes.push(`${afterCounts.projects - beforeCounts.projects > 0 ? '+' : ''}${afterCounts.projects - beforeCounts.projects} projects`);
                    }
                    if (afterCounts.tasks !== beforeCounts.tasks) {
                        changes.push(`${afterCounts.tasks - beforeCounts.tasks > 0 ? '+' : ''}${afterCounts.tasks - beforeCounts.tasks} tasks`);
                    }
                    if (afterCounts.transactions !== beforeCounts.transactions) {
                        changes.push(`${afterCounts.transactions - beforeCounts.transactions > 0 ? '+' : ''}${afterCounts.transactions - beforeCounts.transactions} trans`);
                    }
                    
                    console.log('‚úÖ Merge complete:', changes.length > 0 ? changes.join(', ') : 'No changes');
                    
                    saveData();
                    renderView();
                    updateStats();
                }
                
                // STEP 3: PUSH merged data back to cloud
                console.log('üîÑ Step 3: Pushing merged data to cloud...');
                syncMode.textContent = 'Pushing...';
                const putResponse = await fetch(`${APP_CONFIG.baseUrl}/b/${APP_CONFIG.binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': syncApiKey
                    },
                    body: JSON.stringify(data)
                });
                
                if (!putResponse.ok) {
                    throw new Error(`Push failed: ${putResponse.status} - ${putResponse.statusText}`);
                }
                
                const syncDuration = ((Date.now() - startTime) / 1000).toFixed(1);
                console.log(`‚úÖ Sync complete in ${syncDuration}s`);
                
                localStorage.setItem('lastSyncTime', Date.now().toString());
                const nowTime = new Date().toLocaleTimeString();
                document.getElementById('lastSyncTime').textContent = `Last: ${nowTime}`;
                showToast(`‚úÖ Synced ${data.projects.length}p ${data.tasks.length}t ${data.transactions.length}tr in ${syncDuration}s!`, 5000);
                indicator.classList.remove('syncing');
                syncMode.textContent = 'Connected';
                
            } catch (error) {
                const syncDuration = ((Date.now() - startTime) / 1000).toFixed(1);
                console.error('‚ùå Sync error:', error);
                
                let errorMsg = error.message;
                if (error.message.includes('401')) {
                    errorMsg = 'Invalid API key! Check Settings';
                } else if (error.message.includes('404')) {
                    errorMsg = 'Bin not found! Check Bin ID';
                } else if (error.message.includes('Failed to fetch')) {
                    errorMsg = 'No internet connection!';
                }
                
                showToast(`‚ùå ${errorMsg}`, 6000);
                indicator.classList.remove('syncing');
                syncMode.textContent = 'Error';
                
                // Show detailed error in console
                console.log('Sync diagnostics:', {
                    duration: syncDuration + 's',
                    apiKey: syncApiKey ? 'SET (length: ' + syncApiKey.length + ')' : 'NOT SET',
                    binId: APP_CONFIG.binId,
                    online: navigator.onLine,
                    localData: {
                        projects: data.projects.length,
                        tasks: data.tasks.length,
                        transactions: data.transactions.length
                    }
                });
            }
        }

        function saveApiKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (!key) {
                showToast('Please enter an API key');
                return;
            }
            
            syncApiKey = key;
            localStorage.setItem('builderProSyncApiKey', key);
            document.getElementById('apiKeyInput').value = '';
            document.getElementById('syncMode').textContent = 'Ready';
            showToast('‚úÖ API key saved! Now click "Test Sync Connection"', 5000);
        }

        async function testSync() {
            if (!syncApiKey) {
                showToast('‚ö†Ô∏è No API key set! Enter your JSONBin API key first.');
                return;
            }
            
            showToast('üîç Testing connection...');
            
            try {
                console.log('üîç Testing sync connection...');
                console.log('API Key length:', syncApiKey.length);
                console.log('Bin ID:', APP_CONFIG.binId);
                console.log('Base URL:', APP_CONFIG.baseUrl);
                
                const response = await fetch(`${APP_CONFIG.baseUrl}/b/${APP_CONFIG.binId}/latest`, {
                    headers: {
                        'X-Master-Key': syncApiKey
                    }
                });
                
                console.log('Response status:', response.status);
                console.log('Response OK:', response.ok);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ Connection successful!');
                    console.log('Cloud data:', {
                        projects: result.record?.projects?.length || 0,
                        tasks: result.record?.tasks?.length || 0,
                        transactions: result.record?.transactions?.length || 0
                    });
                    
                    showToast('‚úÖ Connection works! Your API key is valid.');
                    document.getElementById('syncMode').textContent = 'Connected';
                } else if (response.status === 401) {
                    showToast('‚ùå Invalid API key! Get a new one from jsonbin.io');
                    document.getElementById('syncMode').textContent = 'Invalid Key';
                } else if (response.status === 404) {
                    showToast('‚ùå Bin not found! Check your Bin ID.');
                    document.getElementById('syncMode').textContent = 'Invalid Bin';
                } else {
                    showToast(`‚ùå Error ${response.status}: ${response.statusText}`);
                    document.getElementById('syncMode').textContent = 'Error';
                }
            } catch (error) {
                console.error('‚ùå Test failed:', error);
                showToast('‚ùå Connection failed! Check internet & open browser console (F12)');
                document.getElementById('syncMode').textContent = 'Offline';
            }
        }

        function exportData() {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'builder-pro-backup.json';
            a.click();
            URL.revokeObjectURL(url);
            showToast('Data exported');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const imported = JSON.parse(e.target.result);
                        if (confirm('Replace all current data?')) {
                            data = imported;
                            saveData();
                            applySettings();
                            renderView();
                            updateStats();
                            showToast('Data imported');
                        }
                    } catch (error) {
                        showToast('Import failed');
                    }
                };
                reader.readAsText(file);
            }
        }

        // Sticky Note Reminder System
        function setupReminderSystem() {
            // Temporarily disable API for Builder Pro 2.0 development
            apiTempDisabled = true;
            showToast('üîß API temporarily disabled for Builder Pro 2.0 development', 5000);
            
            // Set random interval between 35-45 minutes
            const randomMinutes = 35 + Math.random() * 10; // 35-45 minutes
            const intervalMs = randomMinutes * 60 * 1000;
            
            reminderInterval = setInterval(() => {
                showStickyNote();
            }, intervalMs);
            
            // Show initial reminder after 2 minutes for testing
            setTimeout(() => {
                showStickyNote();
            }, 2 * 60 * 1000);
        }

        function showStickyNote() {
            const stickyNote = document.getElementById('stickyNote');
            const content = document.getElementById('stickyNoteContent');
            
            // Generate dynamic check items based on current app state
            const checkItems = [];
            
            // Check incomplete tasks
            const incompleteTasks = data.tasks.filter(t => !t.deleted && !t.completed).length;
            if (incompleteTasks > 0) {
                checkItems.push(`${incompleteTasks} pending task${incompleteTasks > 1 ? 's' : ''} to complete`);
            }
            
            // Check project progress
            const projectsWithNoTasks = data.projects.filter(p => {
                return !p.deleted && !data.tasks.some(t => t.projectId === p.id && !t.deleted);
            }).length;
            if (projectsWithNoTasks > 0) {
                checkItems.push(`${projectsWithNoTasks} project${projectsWithNoTasks > 1 ? 's' : ''} need tasks`);
            }
            
            // Check financial balance
            const transactions = data.transactions.filter(t => !t.deleted);
            const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = totalIncome - totalExpenses;
            if (balance < 0) {
                checkItems.push(`Budget deficit: ${getCurrencySymbol()}${Math.abs(balance).toFixed(0)}`);
            }
            
            // Check trash
            if (data.trash.length > 10) {
                checkItems.push(`Trash has ${data.trash.length} items`);
            }
            
            // Default items if nothing specific
            if (checkItems.length === 0) {
                checkItems.push('Review your projects');
                checkItems.push('Update task progress');
                checkItems.push('Check financial summary');
            }
            
            // Add development reminder
            checkItems.push('Builder Pro 2.0 in development! üöÄ');
            
            // Generate HTML for check items
            content.innerHTML = checkItems.map(item => 
                `<div class="check-item">${item}</div>`
            ).join('');
            
            // Show sticky note
            stickyNote.classList.add('show');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                stickyNote.classList.remove('show');
            }, 5000);
        }

        // Initialize on load
        window.addEventListener('load', init);

        // Clear all data on initialization (as requested)
        function clearAllInitialData() {
            data.projects = [];
            data.tasks = [];
            data.transactions = [];
            data.trash = [];
            saveData();
            console.log('All data cleared - Ready for fresh start!');
        }
        
        // Render schedule with master Gantt chart
        function renderSchedule() {
            const container = document.getElementById('scheduleSection');
            const projects = data.projects.filter(p => !p.deleted && p.startDate);
            
            if (projects.length === 0) {
                container.innerHTML = `
                    <div class="ai-panel">
                        <div class="ai-panel-header">
                            <div class="ai-icon">ü§ñ</div>
                            <div class="ai-title">AI Schedule Assistant</div>
                        </div>
                        <div class="ai-suggestions">
                            <div class="ai-suggestion">No projects with timelines yet. Create projects with start/end dates to see the schedule.</div>
                        </div>
                        <button class="ai-action-btn" onclick="generateSampleProject()">Generate Sample Project</button>
                    </div>
                `;
                return;
            }
            
            const insights = generateScheduleInsights();
            
            container.innerHTML = `
                ${insights ? `
                    <div class="ai-panel">
                        <div class="ai-panel-header">
                            <div class="ai-icon">ü§ñ</div>
                            <div class="ai-title">AI Schedule Insights</div>
                        </div>
                        <div class="ai-suggestions">
                            ${insights}
                        </div>
                    </div>
                ` : ''}
                
                <div class="gantt-container">
                    <div class="gantt-header">
                        <div class="gantt-title">
                            üìä Master Schedule
                            <span style="font-size: 12px; color: var(--text-secondary); margin-left: 10px;">
                                ${projects.length} active projects
                            </span>
                        </div>
                        <div class="gantt-controls">
                            <button class="gantt-btn ${data.settings.ganttView === 'week' ? 'active' : ''}" 
                                    onclick="changeGanttView('week')">Week</button>
                            <button class="gantt-btn ${data.settings.ganttView === 'month' ? 'active' : ''}" 
                                    onclick="changeGanttView('month')">Month</button>
                            <button class="gantt-btn ${data.settings.ganttView === 'quarter' ? 'active' : ''}" 
                                    onclick="changeGanttView('quarter')">Quarter</button>
                        </div>
                    </div>
                    <div id="masterGantt"></div>
                </div>
            `;
            
            setTimeout(() => renderMasterGantt(), 100);
        }
        
        // Render master Gantt chart
        function renderMasterGantt() {
            const container = document.getElementById('masterGantt');
            if (!container) return;
            
            const projects = data.projects.filter(p => !p.deleted && p.startDate);
            const ganttView = data.settings.ganttView || 'month';
            
            let minDate = new Date();
            let maxDate = new Date();
            
            projects.forEach(project => {
                const start = new Date(project.startDate);
                const end = new Date(project.endDate);
                if (start < minDate) minDate = start;
                if (end > maxDate) maxDate = end;
            });
            
            const today = new Date();
            if (ganttView === 'week') {
                minDate = new Date(today.getTime() - 7*24*60*60*1000);
                maxDate = new Date(today.getTime() + 7*24*60*60*1000);
            } else if (ganttView === 'month') {
                minDate = new Date(today.getFullYear(), today.getMonth(), 1);
                maxDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            } else if (ganttView === 'quarter') {
                const quarter = Math.floor(today.getMonth() / 3);
                minDate = new Date(today.getFullYear(), quarter * 3, 1);
                maxDate = new Date(today.getFullYear(), (quarter + 1) * 3, 0);
            }
            
            const totalDays = Math.ceil((maxDate - minDate) / (24*60*60*1000));
            
            let html = '<div class="gantt-chart" style="height: ' + (projects.length * 50 + 50) + 'px;">';
            
            projects.forEach((project, index) => {
                const startDate = new Date(project.startDate);
                const endDate = new Date(project.endDate);
                
                const projectStart = Math.max(0, Math.ceil((startDate - minDate) / (24*60*60*1000)));
                const projectEnd = Math.min(totalDays, Math.ceil((endDate - minDate) / (24*60*60*1000)));
                const projectDuration = projectEnd - projectStart;
                
                const left = (projectStart / totalDays) * 100;
                const width = (projectDuration / totalDays) * 100;
                
                const colors = ['#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dfe6e9', '#a29bfe', '#fd79a8'];
                const color = colors[index % colors.length];
                
                const tasks = data.tasks.filter(t => t.projectId === project.id && !t.deleted);
                const completed = tasks.filter(t => t.completed).length;
                const progress = tasks.length > 0 ? (completed / tasks.length * 100) : 0;
                
                html += `
                    <div class="gantt-row">
                        <div class="gantt-label">${project.name}</div>
                        <div class="gantt-bar" style="
                            left: ${left}%;
                            width: ${width}%;
                            background: linear-gradient(90deg, ${color} ${progress}%, rgba(255,255,255,0.3) ${progress}%);
                            border: 2px solid ${color};
                        " onclick="viewProject('${project.id}')">
                            ${projectDuration}d (${Math.round(progress)}%)
                        </div>
                    </div>
                `;
            });
            
            if (today >= minDate && today <= maxDate) {
                const todayPosition = ((today - minDate) / (24*60*60*1000) / totalDays) * 100;
                html += `<div class="gantt-today-line" style="left: ${todayPosition}%;"></div>`;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // Change Gantt view
        function changeGanttView(view) {
            data.settings.ganttView = view;
            saveData();
            renderSchedule();
        }
        
        // Generate schedule insights
        function generateScheduleInsights() {
            const projects = data.projects.filter(p => !p.deleted);
            const tasks = data.tasks.filter(t => !t.deleted);
            
            if (projects.length === 0) return null;
            
            let insights = [];
            
            const today = new Date();
            const overdueProjects = projects.filter(p => {
                if (!p.endDate) return false;
                const endDate = new Date(p.endDate);
                const projectTasks = tasks.filter(t => t.projectId === p.id);
                const incompleteTasks = projectTasks.filter(t => !t.completed);
                return endDate < today && incompleteTasks.length > 0;
            });
            
            if (overdueProjects.length > 0) {
                insights.push(`<div class="ai-suggestion">‚ö†Ô∏è ${overdueProjects.length} project${overdueProjects.length > 1 ? 's are' : ' is'} overdue with incomplete tasks</div>`);
            }
            
            const nextWeek = new Date(today.getTime() + 7*24*60*60*1000);
            const endingSoon = projects.filter(p => {
                if (!p.endDate) return false;
                const endDate = new Date(p.endDate);
                return endDate >= today && endDate <= nextWeek;
            });
            
            if (endingSoon.length > 0) {
                insights.push(`<div class="ai-suggestion">üìÖ ${endingSoon.length} project${endingSoon.length > 1 ? 's' : ''} ending within 7 days</div>`);
            }
            
            const activeTasks = tasks.filter(t => !t.completed);
            if (activeTasks.length > 10) {
                insights.push(`<div class="ai-suggestion">üìä High workload detected: ${activeTasks.length} active tasks across projects</div>`);
            }
            
            const completedProjects = projects.filter(p => {
                const projectTasks = tasks.filter(t => t.projectId === p.id);
                return projectTasks.length > 0 && projectTasks.every(t => t.completed);
            });
            
            if (projects.length > 0) {
                const successRate = Math.round((completedProjects.length / projects.length) * 100);
                insights.push(`<div class="ai-suggestion">‚úÖ Project completion rate: ${successRate}%</div>`);
            }
            
            return insights.length > 0 ? insights.join('') : '<div class="ai-suggestion">All projects on track! Keep up the great work! üéØ</div>';
        }
        
        // AI Assistant functions
        function showAIAssistant() {
            const suggestions = generateAISuggestions();
            document.getElementById('aiSuggestionsList').innerHTML = suggestions;
            openModal('aiAssistantModal');
        }
        
        function generateAISuggestions() {
            const projects = data.projects.filter(p => !p.deleted);
            const tasks = data.tasks.filter(t => !t.deleted);
            
            let suggestions = [];
            
            if (projects.length === 0) {
                suggestions.push('<div class="ai-suggestion">üìÅ Start by creating your first project</div>');
            } else {
                const projectTaskCounts = {};
                projects.forEach(p => {
                    projectTaskCounts[p.id] = tasks.filter(t => t.projectId === p.id).length;
                });
                
                const unbalanced = Object.values(projectTaskCounts).some(count => count === 0);
                if (unbalanced) {
                    suggestions.push('<div class="ai-suggestion">‚ö†Ô∏è Some projects have no tasks assigned</div>');
                }
                
                const projectsWithoutDates = projects.filter(p => !p.startDate).length;
                if (projectsWithoutDates > 0) {
                    suggestions.push(`<div class="ai-suggestion">üìÖ ${projectsWithoutDates} project${projectsWithoutDates > 1 ? 's' : ''} missing timeline dates</div>`);
                }
                
                const completionRate = tasks.length > 0 ? 
                    Math.round((tasks.filter(t => t.completed).length / tasks.length) * 100) : 0;
                
                if (completionRate < 30 && tasks.length > 5) {
                    suggestions.push('<div class="ai-suggestion">üí° Consider breaking down large tasks into smaller ones</div>');
                } else if (completionRate > 80) {
                    suggestions.push('<div class="ai-suggestion">üéØ Excellent progress! Time to plan next phase?</div>');
                }
            }
            
            return suggestions.length > 0 ? suggestions.join('') : 
                '<div class="ai-suggestion">‚ú® Everything looks good! Keep up the great work!</div>';
        }
        
        function generateSmartSchedule() {
            const projects = data.projects.filter(p => !p.deleted);
            
            if (projects.length === 0) {
                showToast('No projects to schedule. Create projects first!');
                return;
            }
            
            let currentDate = new Date();
            let updated = 0;
            
            projects.forEach(project => {
                if (!project.startDate) {
                    project.startDate = currentDate.toISOString().split('T')[0];
                    project.endDate = new Date(currentDate.getTime() + 30*24*60*60*1000).toISOString().split('T')[0];
                    currentDate = new Date(currentDate.getTime() + 31*24*60*60*1000);
                    updated++;
                }
            });
            
            if (updated > 0) {
                saveData();
                renderView();
                showToast(`ü§ñ AI scheduled ${updated} project${updated > 1 ? 's' : ''} automatically!`);
            } else {
                showToast('All projects already have schedules!');
            }
            
            closeModal('aiAssistantModal');
        }
        
        function optimizeProjectTimeline() {
            const projects = data.projects.filter(p => !p.deleted && p.startDate);
            
            if (projects.length === 0) {
                showToast('No scheduled projects to optimize!');
                return;
            }
            
            projects.sort((a, b) => {
                const aTasks = data.tasks.filter(t => t.projectId === a.id);
                const bTasks = data.tasks.filter(t => t.projectId === b.id);
                const aUrgency = aTasks.filter(t => !t.completed).length;
                const bUrgency = bTasks.filter(t => !t.completed).length;
                return bUrgency - aUrgency;
            });
            
            let currentDate = new Date();
            projects.forEach(project => {
                const tasks = data.tasks.filter(t => t.projectId === project.id);
                const totalDuration = tasks.reduce((sum, t) => sum + (t.duration || 1), 0) || 30;
                
                project.startDate = currentDate.toISOString().split('T')[0];
                project.endDate = new Date(currentDate.getTime() + totalDuration*24*60*60*1000).toISOString().split('T')[0];
                
                currentDate = new Date(currentDate.getTime() + (totalDuration + 7)*24*60*60*1000);
            });
            
            saveData();
            renderView();
            showToast('ü§ñ Timeline optimized for better workflow!');
            closeModal('aiAssistantModal');
        }
        
        function analyzeBudgetHealth() {
            const projects = data.projects.filter(p => !p.deleted);
            const transactions = data.transactions.filter(t => !t.deleted);
            
            let analysis = 'üìä Budget Analysis:\n\n';
            
            projects.forEach(project => {
                const projectTrans = transactions.filter(t => t.projectId === project.id);
                const income = projectTrans.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                const expenses = projectTrans.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                const balance = income - expenses;
                
                if (project.budget) {
                    const budgetUsage = (expenses / project.budget) * 100;
                    if (budgetUsage > 90) {
                        analysis += `‚ö†Ô∏è ${project.name}: Budget nearly exhausted (${budgetUsage.toFixed(0)}% used)\n`;
                    } else if (budgetUsage > 75) {
                        analysis += `üìç ${project.name}: Budget warning (${budgetUsage.toFixed(0)}% used)\n`;
                    } else {
                        analysis += `‚úÖ ${project.name}: Budget healthy (${budgetUsage.toFixed(0)}% used)\n`;
                    }
                } else {
                    analysis += `üìù ${project.name}: No budget set (Balance: ${getCurrencySymbol()}${balance.toFixed(2)})\n`;
                }
            });
            
            alert(analysis);
            closeModal('aiAssistantModal');
        }
        
        function generateAIProject() {
            const templates = [
                {
                    name: 'Website Redesign',
                    description: 'Complete overhaul of company website with modern design',
                    budget: 5000,
                    duration: 60
                },
                {
                    name: 'Mobile App Development',
                    description: 'Native mobile application for iOS and Android',
                    budget: 15000,
                    duration: 90
                },
                {
                    name: 'Marketing Campaign',
                    description: 'Q1 digital marketing campaign across all channels',
                    budget: 3000,
                    duration: 30
                }
            ];
            
            const template = templates[Math.floor(Math.random() * templates.length)];
            
            document.getElementById('projectName').value = template.name;
            document.getElementById('projectDescription').value = template.description;
            document.getElementById('projectBudget').value = template.budget;
            
            const today = new Date();
            const endDate = new Date(today.getTime() + template.duration*24*60*60*1000);
            document.getElementById('projectStartDate').value = today.toISOString().split('T')[0];
            document.getElementById('projectEndDate').value = endDate.toISOString().split('T')[0];
            
            showToast('ü§ñ AI generated project template!');
        }
        
        function generateSampleProject() {
            const project = {
                id: Date.now().toString(),
                name: 'Sample Project - AI Generated',
                description: 'This is a sample project to demonstrate the scheduling features',
                budget: 10000,
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date(Date.now() + 60*24*60*60*1000).toISOString().split('T')[0],
                created: Date.now(),
                updated: Date.now()
            };
            
            data.projects.push(project);
            
            const sampleTasks = [
                { description: 'Project kickoff meeting', duration: 1, priority: 'high' },
                { description: 'Requirements gathering', duration: 5, priority: 'high' },
                { description: 'Design phase', duration: 10, priority: 'medium' },
                { description: 'Development sprint 1', duration: 14, priority: 'medium' },
                { description: 'Testing and QA', duration: 7, priority: 'high' },
                { description: 'Deployment preparation', duration: 3, priority: 'medium' },
                { description: 'Go-live and monitoring', duration: 2, priority: 'high' }
            ];
            
            sampleTasks.forEach(task => {
                data.tasks.push({
                    id: Date.now().toString() + Math.random(),
                    projectId: project.id,
                    description: task.description,
                    duration: task.duration,
                    priority: task.priority,
                    completed: false,
                    created: Date.now(),
                    updated: Date.now()
                });
            });
            
            saveData();
            renderView();
            updateStats();
            showToast('ü§ñ Sample project created with tasks!');
        }

    </script>
</body>
</html>
